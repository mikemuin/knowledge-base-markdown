# Gemini - Create Conditional Node

Here's how you can create a Conditional Statement in Directus Flows to check if a value from a previous operation exists:

Directus Flows use the Nunjucks templating engine for their expressions, which is very powerful for conditional logic. To check if a value exists, you'll typically use the `if` statement combined with a check for truthiness or specific conditions like `null` or an empty string.

Let's break down the steps:

### Scenario: Checking if an Item ID exists after a "Create Item" operation

Imagine you have a flow that creates an item, and you want to proceed only if the item was successfully created (meaning an ID was returned).

#### Step 1: Identify the Output of the Previous Operation

First, you need to know the "key" or "path" to the value you want to check from the previous operation.

- When you add an operation (e.g., "Create Item", "Read Item", "Call API"), Directus makes its output available in subsequent operations.
- The output of an operation is usually accessible via `{{ $last.<output_key> }}` or `{{ <operation_id>.<output_key> }}`.
- For a "Create Item" operation, the ID of the newly created item is typically available as `{{ $last.id }}` or `{{ create_item_operation_id.id }}`. (Replace `create_item_operation_id` with the actual ID you gave your "Create Item" operation). **Note: The ID is generated by Directus upon successful creation and is part of the operation's output, not something you include in the initial payload.**

### Scenario: Checking if data exists after a "Read Data" operation

When using a "Read Data" operation, the output is typically an array of items found (or an empty array if none are found).

- The data from a "Read Data" operation is usually available under `{{ $last.data }}` (which will be an array).

#### Step 2: Add a "Conditional" Operation

1. In your Directus Flow, click the **"+"** button to add a new operation.
2. Select **"Conditional"** from the list of available operations.

#### Step 3: Configure the Conditional Statement

The "Conditional" operation has a "Conditions" field where you'll write your Nunjucks expression.

**Option 1: Basic Truthiness Check (Most Common)**

This checks if the value is not `null`, `undefined`, `false`, `0`, or an empty string.

```
{{ $last.id }}
```

**Explanation:** If `$last.id` has *any* value (like a number, string, or object), this condition will evaluate to `true`. If it's `null`, `undefined`, `0`, `false`, or an empty string, it will evaluate to `false`. This is often sufficient for checking existence.

**Option 2: Explicitly Checking for `null` or `undefined`**

If you want to be more explicit about checking for the absence of a value (e.g., if it's specifically `null` or `undefined`), you can use:

```
{{ $last.id !== null }}
```

Or to check if it *doesn't* exist:

```
{{ $last.id === null }}
```

**Option 3: Checking for Empty Strings (if the value could be an empty string)**

If the value you're checking could legitimately be an empty string and you consider that "non-existent" for your logic, you can combine checks:

```
{{ $last.id && $last.id !== '' }}
```

**Explanation:** This condition will only be `true` if `$last.id` exists *and* it's not an empty string.

**Option 4: Checking for Array/Object Emptiness (Common for "Read Data" operations)**

If the previous operation returns an array or an object, and you want to check if it's empty:

- **For Arrays (e.g., output of "Read Data"):** To check if the "Read Data" operation returned any items:

  ```
  {{ $last.data | length > 0 }}
  ```

Or to check if it's empty (no items found):

  ```
  {{ $last.data | length === 0 }}
  ```

You can also check for the existence of the first item if you expect at least one:

  ```
  {{ $last.data[0] }}
  ```

- **For Objects (checking if it has properties):** This is a bit trickier in pure Nunjucks. You might need to stringify it and check its length, or rely on a property that *should* exist if the object is valid. A simple truthiness check on the object itself (`{{ $last.data }}`) will work if the object is `null` or `undefined`, but not if it's an empty object `{}`.

A common workaround is to check for a key that *must* exist if the object is valid:

  ```
  {{ $last.data.some_expected_key }}
  ```

(This will be `true` if `some_expected_key` exists and has a truthy value, and `false` otherwise.)

#### Step 4: Define "True" and "False" Paths

After configuring the "Conditions" field:

1. **"On True" Path:** Drag and drop subsequent operations under the "On True" branch of the Conditional operation. These operations will execute if your condition evaluates to `true`.
2. **"On False" Path:** Drag and drop subsequent operations under the "On False" branch. These operations will execute if your condition evaluates to `false`.

#### Example Walkthrough: Create Item and Send Notification Only if Successful

1. **Operation 1: Create Item**
   - Type: `Create Item`
   - Collection: `articles`
   - Payload: `{"title": "My New Article", "content": "..."}`
     - *(Note: You do not set the ID in the payload for a "Create Item" operation. Directus generates the ID upon successful creation.)*
   - Let's assume its ID is `create_article_op`.
2. **Operation 2: Conditional**
   - Type: `Conditional`
   - Conditions: `{{ create_article_op.id }}` (or `{{ $last.id }}` if this is the immediate next operation)
3. **"On True" Path (if article created)**
   - **Operation 3: Send Email**
     - Type: `Send Email`
     - Subject: `Article Created: {{ create_article_op.id }}`
     - Body: `Your article "{{ create_article_op.title }}" has been successfully created.`
4. **"On False" Path (if article creation failed or ID was null)**
   - **Operation 4: Log Error**
     - Type: `Log`
     - Level: `Error`
     - Message: `Failed to create article. No ID returned.`

#### Example Walkthrough: Read Data and Proceed Only if Records Found

1. **Operation 1: Read Data**
   - Type: `Read Data`
   - Collection: `users`
   - Query: `{"filter": {"status": {"_eq": "active"}}}`
     - *(This operation will return an array of user objects that are active)*
   - Let's assume its ID is `read_active_users_op`.
2. **Operation 2: Conditional**
   - Type: `Conditional`
   - Conditions: `{{ read_active_users_op.data | length > 0 }}` (or `{{ $last.data | length > 0 }}` if this is the immediate next operation)
3. **"On True" Path (if active users found)**
   - **Operation 3: Send Email**
     - Type: `Send Email`
     - Subject: `Active Users Report`
     - Body: `Found {{ read_active_users_op.data | length }} active users.` (You could then loop through them if needed)
4. **"On False" Path (if no active users found)**
   - **Operation 4: Log Info**
     - Type: `Log`
     - Level: `Info`
     - Message: `No active users found.`

By following these steps, you can effectively control the flow of your Directus automations based on the existence of values from previous operations.